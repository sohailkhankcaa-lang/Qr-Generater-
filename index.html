<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Invitation Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#eee;
  font-family:Arial, sans-serif;
  text-align:center;
}

textarea{
  width:95%;
  height:140px;
}

button{
  padding:8px 14px;
  margin:6px;
  font-size:14px;
  cursor:pointer;
}

#output{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(304px, 1fr));
  gap:20px;
  justify-items:center;
}

/* CARD */
.card{
  position:relative;
  width:304px;
  height:455px;
  page-break-inside: avoid;
  break-inside: avoid;
}

/* TEMPLATE IMAGE */
.template{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:0;
}

/* TEXT POSITIONS */
.name{
  position:absolute;
  left:85px;
  top:160px;
  font-size:18px;
  font-weight:bold;
  z-index:1;
}

.mobile{
  position:absolute;
  left:90px;
  top:215px;
  font-size:18px;
  font-weight:bold;
  z-index:1;
}

.lucky{
  position:absolute;
  right:60px;
  top:43px;
  font-size:20px;
  font-weight:bold;
  z-index:1;
}

.qr{
  position:absolute;
  left:88px;
  top:268px;
  width:130px;
  height:130px;
  z-index:1;
}

/* COPY BUTTON */
.copy-btn{
  background:#000;
  color:#fff;
  border:none;
  border-radius:5px;
}

.copy-btn:disabled{
  background:green;
}
</style>
</head>

<body>

<h3>Bulk Invitation Generator</h3>

<textarea id="data" placeholder="AMAN DEEP JI 966220561&#10;ISWAR RAM JI 8696797115"></textarea><br>
<button onclick="generate()">Generate</button>

<div id="output"></div>

<!-- QR CODE LIBRARY -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<!-- HTML2CANVAS (EXACT VISUAL COPY) -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
function generate(){
  const raw = document.getElementById("data").value.trim();
  if(!raw){
    alert("List paste karo");
    return;
  }

  const out = document.getElementById("output");
  out.innerHTML = "";

  raw.split("\n").forEach((line,i)=>{
    if(!line.trim()) return;

    const parts = line.trim().split(/\s+/);
    if(parts.length < 2) return;

    const mobile = parts.pop();
    const name = parts.join(" ");
    const lucky = i + 1; // no leading zero

    const wrapper = document.createElement("div");

    wrapper.innerHTML = `
      <button class="copy-btn" id="copyBtn${i}" onclick="copyCard(${i})">
        ðŸ“‹ COPY IMAGE
      </button>
      <div class="card" id="card${i}">
        <img src="template.png" class="template">
        <div class="lucky">${lucky}</div>
        <div class="name">${name}</div>
        <div class="mobile">${mobile}</div>
        <div class="qr" id="qr${i}"></div>
      </div>
    `;

    out.appendChild(wrapper);

    new QRCode(document.getElementById("qr"+i),{
      text: name + "\n" + mobile + "\nLucky:" + lucky,
      width:130,
      height:130,
      correctLevel: QRCode.CorrectLevel.H
    });
  });
}

/* COPY EXACT CARD AS IMAGE */
async function copyCard(index){
  const card = document.getElementById("card"+index);
  const btn  = document.getElementById("copyBtn"+index);

  const canvas = await html2canvas(card, {
    scale: 2,
    useCORS: true,
    backgroundColor: null
  });

  canvas.toBlob(async blob=>{
    await navigator.clipboard.write([
      new ClipboardItem({ "image/png": blob })
    ]);

    const oldText = btn.innerHTML;
    btn.innerHTML = "âœ” COPIED";
    btn.disabled = true;

    setTimeout(()=>{
      btn.innerHTML = oldText;
      btn.disabled = false;
    },3000);
  });
}
</script>

</body>
</html>
