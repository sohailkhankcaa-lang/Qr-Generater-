<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Invitation Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#eee;
  font-family:Arial, sans-serif;
  text-align:center;
}

textarea{
  width:95%;
  height:140px;
}

button{
  padding:8px 14px;
  margin:6px;
  font-size:14px;
  cursor:pointer;
}

#output{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(304px, 1fr));
  gap:20px;
  justify-items:center;
}

/* CARD */
.card{
  position:relative;
  width:304px;
  height:455px;
  page-break-inside: avoid;
  break-inside: avoid;
}

/* TEMPLATE IMAGE */
.template{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  z-index:0;
}

/* TEXT */
.name{
  position:absolute;
  left:85px;
  top:160px;
  font-size:18px;
  font-weight:bold;
  z-index:1;
}

.mobile{
  position:absolute;
  left:90px;
  top:215px;
  font-size:18px;
  font-weight:bold;
  z-index:1;
}

.lucky{
  position:absolute;
  right:60px;
  top:43px;
  font-size:20px;
  font-weight:bold;
  z-index:1;
}

.qr{
  position:absolute;
  left:88px;
  top:268px;
  width:130px;
  height:130px;
  z-index:1;
}

/* COPY BUTTON */
.copy-btn{
  margin-bottom:6px;
  background:#000;
  color:#fff;
  border:none;
  border-radius:5px;
}
</style>
</head>

<body>

<h3>Bulk Invitation Generator</h3>

<textarea id="data" placeholder="NAME 966220561&#10;NAME 8696797115"></textarea><br>
<button onclick="generate()">Generate</button>

<div id="output"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<script>
function generate(){
  const raw = document.getElementById("data").value.trim();
  if(!raw){
    alert("List paste karo");
    return;
  }

  const out = document.getElementById("output");
  out.innerHTML = "";

  raw.split("\n").forEach((line,i)=>{
    if(!line.trim()) return;

    const parts = line.trim().split(/\s+/);
    if(parts.length < 2) return;

    const mobile = parts.pop();
    const name = parts.join(" ");
    const lucky = i + 1;

    const wrapper = document.createElement("div");

    wrapper.innerHTML = `
      <button class="copy-btn" onclick="copyCard(${i})">ðŸ“‹ COPY IMAGE</button>
      <div class="card" id="card${i}">
        <img src="template.png" class="template">
        <div class="lucky">${lucky}</div>
        <div class="name">${name}</div>
        <div class="mobile">${mobile}</div>
        <div class="qr" id="qr${i}"></div>
      </div>
    `;

    out.appendChild(wrapper);

    new QRCode(document.getElementById("qr"+i),{
      text: name + "\n" + mobile + "\nLucky:" + lucky,
      width:130,
      height:130,
      correctLevel: QRCode.CorrectLevel.H
    });
  });
}

/* COPY IMAGE LOGIC */
async function copyCard(index){
  const card = document.getElementById("card"+index);

  const canvas = document.createElement("canvas");
  canvas.width = card.offsetWidth;
  canvas.height = card.offsetHeight;
  const ctx = canvas.getContext("2d");

  const bg = card.querySelector(".template");
  await new Promise(r=>{
    const img = new Image();
    img.src = bg.src;
    img.onload = ()=>{
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      r();
    };
  });

  // Draw texts
  const lucky = card.querySelector(".lucky").innerText;
  const name = card.querySelector(".name").innerText;
  const mobile = card.querySelector(".mobile").innerText;

  ctx.fillStyle="#000";
  ctx.font="bold 20px Arial";
  ctx.fillText(lucky, canvas.width-120, 60);

  ctx.font="bold 18px Arial";
  ctx.fillText(name, 85, 185);
  ctx.fillText(mobile, 90, 240);

  // Draw QR
  const qrImg = card.querySelector(".qr img");
  await new Promise(r=>{
    const q = new Image();
    q.src = qrImg.src;
    q.onload = ()=>{
      ctx.drawImage(q,88,268,130,130);
      r();
    };
  });

  canvas.toBlob(async blob=>{
    await navigator.clipboard.write([
      new ClipboardItem({ "image/png": blob })
    ]);
    alert("Image copied! WhatsApp pe paste karo âœ…");
  });
}
</script>

</body>
</html>
